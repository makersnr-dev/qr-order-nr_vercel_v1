<!DOCTYPE html>
<html lang="ko"><head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>QR Order - 배달/예약</title>
<script src="https://js.tosspayments.com/v1"></script>
<style>body{font-family:system-ui,Segoe UI,Noto Sans KR,sans-serif;background:#0b0f14;color:#e6edf3;margin:0} .wrap{max-width:700px;margin:20px auto;padding:16px} .card{background:#0d131b;border:1px solid #223;border-radius:12px;padding:12px;margin-bottom:12px} .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap} .btn{padding:10px 14px;border:1px solid #294760;border-radius:10px;background:linear-gradient(180deg,#0d2233,#0a1824);color:#e6edf3;cursor:pointer} input,select,textarea{padding:10px;border-radius:10px;border:1px solid #223;background:#0e1520;color:#e6edf3}
.menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
.menu-card{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;width:100%;aspect-ratio:1/1;border-radius:12px;border:1px solid #223;background:linear-gradient(180deg,#0d2233,#0a1824);color:#e6edf3;cursor:pointer;padding:8px}
.menu-card:hover{filter:brightness(1.06)}
.menu-title{font-weight:600;line-height:1.2;word-break:keep-all;overflow-wrap:anywhere}
.menu-price{margin-top:6px;opacity:.9;font-size:.9em}
.required{color:#f88}
.small{opacity:.8;font-size:14px}
.tabBtn{padding:8px 12px;border-radius:8px;border:1px solid #335;background:#0b1a2b;color:#e6edf3;cursor:pointer}
.tabBtn.active{background:#14324a}
.tabPane{display:none}
.tabPane.active{display:block}
.hint{margin-left:8px;opacity:.8;font-size:12px} .inline-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.form-row{display:flex;align-items:center;gap:12px;margin:8px 0;flex-wrap:wrap}
.form-row label{width:110px;min-width:110px;text-align:left;opacity:.95}
.form-row input{flex:1}
/* 예약시간 라벨을 드롭다운 왼쪽에 두고, 화면이 좁아지면 라벨과 드롭다운을 함께 아래로 이동 */
.form-row.time-row{align-items:center}
.form-row.time-row .time-group{display:flex; gap:8px; flex-wrap:wrap; flex:1}
@media (max-width: 520px){
  .form-row.time-row{align-items:flex-start}
  .form-row.time-row label{width:100%; min-width:0; margin-bottom:6px}
  .form-row.time-row .time-group{width:100%}
}
.subTabBtn{background:#0b3050;color:#e6edf3;border:1px solid #234;padding:6px 10px;border-radius:8px;cursor:pointer}
.subTabBtn.active{background:#1976d2}
.hidden{display:none}
</style>
</head><body><div class="wrap">
<h1>배달/예약</h1>
<div class="row" style="margin:8px 0 12px;gap:14px">
  <label><input type="radio" name="orderMode" id="orderModeDelivery" checked> 배달(결제)</label>
  <label><input type="radio" name="orderMode" id="orderModeReserve"> 예약(무결제)</label>
</div>
<div class="card" style="margin-bottom:10px">
<div id="tabs" style="display:flex;gap:8px">
<button class="tabBtn active" data-tab="order">주문</button>
<button class="tabBtn" data-tab="history">이전 주문</button>
</div>
</div>
<div class="tabPane active" id="orderPane">
<div class="card">
<h3>배달/예약 정보 <span class="required">*</span></h3>
<div class="row"><div class="form-row"><label for="addr">주소</label><input aria-label="배달 받을 주소" id="addr" placeholder="배송지 주소 *" required=""/></div></div>
<div class="row"><div class="form-row"><label for="name">주문자</label><input aria-label="주문자 성함" id="name" placeholder="주문자 이름 *" required=""/></div></div>
<div class="row"><div class="form-row"><label for="phone">연락처</label><input aria-label="연락용 번호(숫자만)" id="phone" inputmode="numeric" pattern="\d{8,13}" placeholder="연락처 (숫자만) *" required="" title="숫자만 8~13자리"/></div></div>
<div class="row">
<div class="form-row"><label for="date">예약일자</label><input aria-label="예약일자 (미입력 시 즉시주문)" id="date" inputmode="none" min="2025-10-31" onfocus="this.showPicker &amp;&amp; this.showPicker()" type="date"/></div>
<div class="form-row time-row"><label for="time">예약시간</label><div class="time-group" style="display:flex; gap:8px; flex-wrap:wrap; width:100%"><select aria-label="오전/오후" id="timePeriod" name="timePeriod" required=""><option disabled="" selected="" value="">오전/오후</option><option value="AM">오전</option><option value="PM">오후</option></select><select aria-label="시간(1~12)" id="timeHour" name="timeHour" required=""><option disabled="" selected="" value="">시</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select><select aria-label="분(5분)" id="timeMinute" name="timeMinute" required=""><option disabled="" selected="" value="">분</option><option value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select></div></div>
</div>
<div class="row"><textarea id="note" placeholder="요청사항" style="width:100%;min-height:80px"></textarea></div>
</div>
<div class="card">
<h3>메뉴</h3>
<div class="menu-grid" id="menu"></div>
</div>
<div class="card">
<h3>장바구니 <span class="small" id="cartCountBadge"></span></h3>
<div id="cartList"></div>
</div>
<div class="card">
<div class="row">
<div>합계: <b id="sum">0</b>원</div>
<button class="btn" id="payBtn">결제하기</button><button class="btn hidden" id="bankCopyBtn" style="margin-left:8px">입금계좌 복사</button><span id="bankCopyMsg" class="small hidden" style="margin-left:6px"></span>
</div>
</div>
</div>
<div class="tabPane" id="historyPane">
<div class="card">
<h3>이전 주문</h3>
<div id="history"></div>
<div class="small">이 브라우저에서 진행된 최근 주문을 표시합니다.</div>
</div>
</div>

</div>


<script>
let __bankInfo = null;

function showReserveUI(show){
  const btn = document.getElementById('bankCopyBtn');
  const msg = document.getElementById('bankCopyMsg');
  if(btn){ btn.classList.toggle('hidden', !show); }
  if(msg){ msg.classList.toggle('hidden', !show); }
}

async function fetchBankInfo(){
  try{
    const r = await fetch(joinUrl(ORDER_BASE||'', '/bank-info/public'));
    if(!r.ok) return;
    const j = await r.json();
    __bankInfo = (j && j.data) || null;
  }catch(e){}
}

function copyBankInfo(){
  if(!__bankInfo) return;
  const text = [__bankInfo.bank||'', __bankInfo.account||'', __bankInfo.holder||'']
    .filter(Boolean).join(' / ');
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text);
  }
  const m = document.getElementById('bankCopyMsg');
  if(m){ m.textContent='복사됨'; setTimeout(()=>m.textContent='',1500); }
}

function updatePayButton(){
  const payBtn = document.getElementById('payBtn');
  const isReserve = !!(document.getElementById('orderModeReserve') && document.getElementById('orderModeReserve').checked);
  if(payBtn){ payBtn.textContent = isReserve ? '예약하기' : '결제하기'; }
}

document.addEventListener('DOMContentLoaded', ()=>{
  const mDel = document.getElementById('orderModeDelivery');
  const mRes = document.getElementById('orderModeReserve');
  const bankBtn = document.getElementById('bankCopyBtn');

  if(mDel && mRes){
    mDel.addEventListener('change', ()=>{ showReserveUI(false); updatePayButton(); });
    mRes.addEventListener('change', ()=>{ showReserveUI(true); fetchBankInfo(); updatePayButton(); });
  }
  if(bankBtn){ bankBtn.addEventListener('click', copyBankInfo); }
  updatePayButton();
});
</script>

</body></html>