<!doctype html><html lang="ko"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>배달/예약 주문</title>
<style>
body{font-family:system-ui,Noto Sans KR,sans-serif;background:#0b1220;color:#e6edf3;margin:0}
.wrap{max-width:900px;margin:30px auto;padding:16px}
.grid{display:grid;grid-template-columns:1.2fr 0.8fr;gap:12px}
.card{background:#0f172a;border:1px solid #223;border-radius:12px;padding:16px}
.row{display:flex;gap:8px;align-items:center;margin:8px 0}
input,textarea,select{padding:10px;border-radius:8px;border:1px solid #335;background:#0b1a2b;color:#e6edf3;width:100%}
h1{margin:0 0 12px 0}
.btn{padding:12px 14px;border-radius:10px;border:1px solid #335;background:#14324a;color:#e6edf3;cursor:pointer}
.small{opacity:.8;font-size:12px}
.menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}
.menu-card{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px;border-radius:10px;border:1px solid #223;background:linear-gradient(180deg,#0f1b2a,#0b1623);cursor:pointer}
.menu-title{font-weight:600}
.menu-price{opacity:.9;font-size:.9em;margin-top:4px}
</style></head><body><div class="wrap">
<h1>배달/예약 주문</h1>
<div class="grid">
  <div class="card">
    <h3>메뉴</h3>
    <div id="menu" class="menu-grid"></div>
  </div>
  <div class="card">
    <h3>정보</h3>
    <div class="row"><input id="addr" placeholder="배송지 주소"/></div>
    <div class="row"><input id="name" placeholder="주문자 이름"/></div>
    <div class="row"><input id="phone" placeholder="연락처"/></div>
    <div class="row">
      <label style="width:90px">예약일자</label>
      <input type="date" id="date"/>
      <input type="time" id="time"/>
    </div>
    <div class="row"><button class="btn" id="submitBtn">주문 요청</button></div>
    <div class="small">결제는 매장에서 진행되며, 관리자 확인 후 연락드립니다.</div>
    <div id="msg" class="small" style="margin-top:8px"></div>
  </div>
</div>

<div class="card" style="margin-top:12px">
  <h3>이전 주문</h3>
  <div id="history"></div>
</div>

<script>
async function loadMenu(){
  try{
    const base = location.origin;
    const r = await fetch(base + '/menu'); const arr = await r.json();
    const box = document.getElementById('menu');
    box.innerHTML = arr.map(m=>`
      <button class="menu-card" onclick="add('${m.id}', ${m.price})">
        <div class="menu-title">${m.name}</div>
        <div class="menu-price">${(m.price||0).toLocaleString('ko-KR')}원</div>
      </button>`).join('');
  }catch(e){ console.warn('메뉴 로드 실패', e); }
}
const cart = new Map();
function add(id, price){ const q = (cart.get(id)||0)+1; cart.set(id,q); document.getElementById('msg').textContent = '선택: '+id+' x '+q; }
function saveHistory(item){
  const key='qrOrderHistory';
  const arr=JSON.parse(localStorage.getItem(key)||'[]');
  arr.push(item); localStorage.setItem(key, JSON.stringify(arr.slice(-200)));
}
document.getElementById('submitBtn').onclick = function(){
  const addr=document.getElementById('addr').value.trim();
  const name=document.getElementById('name').value.trim();
  const phone=document.getElementById('phone').value.trim();
  const date=document.getElementById('date').value; const time=document.getElementById('time').value;
  if(!addr||!name||!phone){ alert('배송지/주문자/연락처를 입력해주세요'); return; }
  const items = Array.from(cart.entries()).map(([id,qty])=>[id,qty]);
  const amount = 0; // 오프라인 결제 가정
  saveHistory({ time:Date.now(), items, amount, addr, name, phone, reserve:`${date} ${time}` });
  document.getElementById('msg').textContent = '주문 요청이 접수되었습니다. 이전 주문에서 확인할 수 있어요.';
};
function renderHistory(){
  const box=document.getElementById('history');
  const arr=JSON.parse(localStorage.getItem('qrOrderHistory')||'[]');
  if(!arr.length){ box.innerHTML='<div class="small">표시할 내역이 없습니다.</div>'; return; }
  box.innerHTML = arr.slice(-50).reverse().map(o=>{
    const when = new Date(o.time||Date.now()); const m=String(when.getMonth()+1).padStart(2,'0'); const d=String(when.getDate()).padStart(2,'0');
    const hh=String(when.getHours()).padStart(2,'0'); const mi=String(when.getMinutes()).padStart(2,'0');
    const items=(o.items||[]).map(p=>p[0]+'×'+p[1]).join(', ');
    const extra = [o.addr?(' · '+o.addr):'', o.reserve?(' · '+o.reserve):''].join('');
    return `<div style="padding:6px 0;border-bottom:1px solid #223">${m}/${d} ${hh}:${mi} · ${items}${extra}</div>`;
  }).join('');
}
loadMenu(); renderHistory();
</script>
</div></body></html>